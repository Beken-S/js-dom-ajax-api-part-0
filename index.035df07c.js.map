{"mappings":"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","sources":["src/scripts/common/debounce.js","src/scripts/common/only-last.js","src/scripts/common/errors.js","src/scripts/common/get-data.js","src/scripts/api/api-provider.js","src/scripts/common/utils.js","src/scripts/components/search-history/index.js","src/scripts/components/suggestions/index.js","src/scripts/components/scores/index.js","src/scripts/index.js"],"sourcesContent":["function debounce(callee, timeoutMs) {\n    let timer;\n\n    return function perform(...args) {\n        if (timer != null) {\n            clearTimeout(timer);\n        }\n\n        timer = setTimeout(() => callee(...args), timeoutMs);\n    };\n}\n\nexport { debounce };\n","// для отмены предыдущего fetch если следующи выполнился раньше него\nfunction onlyLast(callee) {\n    let controller = new AbortController();\n    let isOverPreviousCall = true;\n\n    return async function (...args) {\n        if (!isOverPreviousCall) {\n            controller.abort();\n            controller = new AbortController();\n        }\n\n        isOverPreviousCall = false;\n        try {\n            const response = await callee(...args, controller.signal);\n            isOverPreviousCall = true;\n            return response;\n        } catch (error) {\n            isOverPreviousCall = true;\n            throw error;\n        }\n    };\n}\n\nexport { onlyLast };\n","class BaseError extends Error {\n    constructor(status, message) {\n        super(message);\n        this.status = status;\n    }\n}\n\nconst ERROR_CODE = {\n    BadRequest: 400,\n    NotFound: 404,\n    InvalidResponse: 1000,\n    NetworkError: 1001,\n    TypeError: 4000,\n    UnexpectedError: 5000,\n};\n\nexport { ERROR_CODE, BaseError };\n","import { ERROR_CODE, BaseError } from './errors';\n\nasync function getData(url, signal) {\n    let response;\n    try {\n        response = await fetch(url, {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            redirect: 'follow',\n            signal,\n        });\n    } catch (error) {\n        if (error instanceof DOMException) {\n            return [null, error];\n        }\n        return [null, new BaseError(ERROR_CODE.NetworkError, error.message)];\n    }\n\n    if (response.ok) {\n        return [await response.json(), null];\n    }\n    if (response.status === 400) {\n        return [null, new BaseError(ERROR_CODE.BadRequest, 'Некорректный запрос.')];\n    }\n    if (response.status === 404) {\n        return [null, new BaseError(ERROR_CODE.NotFound, 'Информация не найдена.')];\n    }\n    return [null, new BaseError(ERROR_CODE.UnexpectedError, 'Что-то пошло не так.')];\n}\n\nexport { getData };\n","import { BaseError, ERROR_CODE } from '../common/errors';\nimport { getData } from '../common/get-data';\n\nconst BASE_URL = 'https://api.teleport.org';\nconst MAIN_PATH = 'api';\nconst SEARCH_PARAMS = new URLSearchParams([\n    ['search', ''],\n    ['limit', 10],\n]);\n\n// тайп гарды\nfunction isObject(value) {\n    return typeof value === 'object' && value != null;\n}\nfunction hasEmbedded(value) {\n    return '_embedded' in value;\n}\nfunction isLink(value) {\n    return isObject(value) && 'href' in value && typeof value.href === 'string';\n}\nfunction isLinks(value) {\n    return isObject(value) && 'city:item' in value && isLink(value['city:item']);\n}\nfunction isSearchItem(value) {\n    return (\n        isObject(value) &&\n        'matching_full_name' in value &&\n        '_links' in value &&\n        typeof value.matching_full_name === 'string' &&\n        isLinks(value._links)\n    );\n}\nfunction isSearchItemsArray(value) {\n    return Array.isArray(value) && value.every(isSearchItem);\n}\nfunction isSearchResult(value) {\n    return isObject(value) && 'city:search-results' && isSearchItemsArray(value['city:search-results']);\n}\nfunction isValidSearchResult(value) {\n    return isObject(value) && hasEmbedded(value) && isSearchResult(value._embedded);\n}\nfunction isCategory(value) {\n    return (\n        isObject(value) &&\n        'color' in value &&\n        'name' in value &&\n        'score_out_of_10' in value &&\n        typeof value.color === 'string' &&\n        typeof value.name === 'string' &&\n        typeof value.score_out_of_10 === 'number'\n    );\n}\nfunction isArrayCategories(value) {\n    return Array.isArray(value) && value.every(isCategory);\n}\nfunction isUaScores(value) {\n    return (\n        isObject(value) &&\n        'categories' in value &&\n        'teleport_city_score' &&\n        typeof value.teleport_city_score === 'number' &&\n        isArrayCategories(value.categories)\n    );\n}\nfunction isCityUrbanArea(value) {\n    return (\n        isObject(value) &&\n        hasEmbedded(value) &&\n        'full_name' in value &&\n        'ua:scores' in value._embedded &&\n        typeof value.full_name === 'string' &&\n        isUaScores(value._embedded['ua:scores'])\n    );\n}\nfunction isValidGetScoresResult(value) {\n    return (\n        isObject(value) &&\n        hasEmbedded(value) &&\n        'city:urban_area' in value._embedded &&\n        isCityUrbanArea(value._embedded['city:urban_area'])\n    );\n}\n\nasync function searchCity(query, signal) {\n    const url = new URL(`${MAIN_PATH}/cities`, BASE_URL);\n    SEARCH_PARAMS.set('search', query);\n    url.search = SEARCH_PARAMS.toString();\n\n    const [data, error] = await getData(url.toString(), signal);\n\n    if (error) {\n        return [null, error];\n    }\n\n    if (!isValidSearchResult(data)) {\n        return [null, new BaseError(ERROR_CODE.InvalidResponse, 'Invalid response.')];\n    }\n\n    if (data.count === 0) {\n        return [null, null];\n    }\n\n    const suggestions = data._embedded['city:search-results'].reduce((acc, item) => {\n        acc.push({\n            id: item._links['city:item'].href.match(/\\d+/)[0],\n            link: item._links['city:item'].href,\n            suggestion: item.matching_full_name,\n        });\n        return acc;\n    }, []);\n\n    return [suggestions, null];\n}\n\nasync function getScores(urlString, signal) {\n    const url = new URL(urlString);\n    SEARCH_PARAMS.set('embed', 'city:urban_area/ua:scores');\n    url.search = SEARCH_PARAMS.toString();\n\n    const [data, error] = await getData(url.toString(), signal);\n\n    if (error) {\n        return [null, error];\n    }\n\n    if (!isValidGetScoresResult(data)) {\n        return [null, new BaseError(ERROR_CODE.NotFound, 'There are no statistics for this city.')];\n    }\n\n    return [\n        {\n            name: data._embedded['city:urban_area'].full_name,\n            categories: data._embedded['city:urban_area']._embedded['ua:scores'].categories,\n            totalScore: data._embedded['city:urban_area']._embedded['ua:scores'].teleport_city_score,\n        },\n        null,\n    ];\n}\n\nexport { searchCity, getScores };\n","function escape(string) {\n    const regexp = /[.*+?^${}()|[\\]\\\\]/g;\n    return string.replace(regexp, '\\\\$&');\n}\n\nfunction getHide(element) {\n    return function () {\n        element.classList.add('hidden');\n    };\n}\n\nfunction getShow(element) {\n    return function () {\n        element.classList.remove('hidden');\n    };\n}\n\nfunction getSelectChildrenSequentially(element, addedClassName) {\n    let currentChild = null;\n\n    return function (action) {\n        const firstChild = element.firstElementChild;\n        const lastChild = element.lastElementChild;\n\n        function update() {\n            if (currentChild != null) {\n                currentChild.classList.remove(addedClassName);\n                currentChild = null;\n            }\n        }\n        function selectFirst() {\n            currentChild = firstChild;\n\n            if (currentChild != null) {\n                currentChild.classList.add(addedClassName);\n            }\n        }\n        function selectNext() {\n            if (firstChild == null && lastChild == null) {\n                return;\n            }\n            if (currentChild == null) {\n                currentChild = firstChild;\n            }\n\n            const nextChild = currentChild?.nextElementSibling;\n\n            currentChild.classList.remove(addedClassName);\n\n            if (nextChild != null) {\n                currentChild = nextChild;\n            } else {\n                currentChild = firstChild;\n            }\n            currentChild.classList.add(addedClassName);\n        }\n        function selectPrevious() {\n            if (firstChild == null && lastChild == null) {\n                return;\n            }\n            if (currentChild == null) {\n                currentChild = lastChild;\n            }\n\n            const previousChild = currentChild?.previousElementSibling;\n\n            currentChild.classList.remove(addedClassName);\n\n            if (previousChild != null) {\n                currentChild = previousChild;\n            } else {\n                currentChild = lastChild;\n            }\n            currentChild.classList.add(addedClassName);\n        }\n\n        switch (action) {\n            case 'update':\n                update();\n                break;\n            case 'first':\n                selectFirst();\n                break;\n            case 'next':\n                selectNext();\n                break;\n            case 'previous':\n                selectPrevious();\n                break;\n        }\n\n        return currentChild;\n    };\n}\n\nexport { getHide, getShow, getSelectChildrenSequentially, escape };\n","import { escape } from '../../common/utils';\n\nclass SearchHistory {\n    constructor(maxLength) {\n        this.maxLength = maxLength;\n        if (this.get() == null) {\n            localStorage.setItem('searchHistory', JSON.stringify([]));\n        }\n    }\n\n    get() {\n        return JSON.parse(localStorage.getItem('searchHistory'));\n    }\n\n    add(query) {\n        const history = this.get();\n\n        const index = history.findIndex((item) => item.id === query.id);\n\n        if (index > -1) {\n            history.splice(index, 1);\n        } else if (history.length > this.maxLength) {\n            history.pop();\n        }\n\n        localStorage.setItem('searchHistory', JSON.stringify([query, ...history]));\n    }\n\n    getRecentSearchQueries(count) {\n        const history = this.get();\n        return history.slice(0, count);\n    }\n\n    findRecentSearchQueries(query, count) {\n        const regexp = new RegExp(escape(query), 'i');\n        const history = this.get();\n        const itemsId = [];\n        const items = [];\n\n        if (history.length === 0) {\n            return [null, null];\n        }\n\n        for (const historyItem of history) {\n            if (items.length === count) {\n                break;\n            }\n            if (historyItem.suggestion.search(regexp) > -1) {\n                itemsId.push(historyItem.id);\n                items.push(historyItem);\n            }\n        }\n\n        if (items.length === 0) {\n            return [null, null];\n        }\n\n        return [itemsId, items];\n    }\n}\n\nfunction createHistoryItem({ suggestion, link }) {\n    const historyItem = document.createElement('li');\n    historyItem.classList.add('history__item');\n    historyItem.dataset.link = link;\n    historyItem.textContent = suggestion;\n    return historyItem;\n}\n\nfunction getHistoryItems(suggestions) {\n    const fragment = document.createDocumentFragment();\n    fragment.append(...suggestions.map(createHistoryItem));\n    return fragment;\n}\n\nfunction getRenderToHistory(historyElement) {\n    return function (suggestions) {\n        if (suggestions == null) {\n            historyElement.replaceChildren('');\n            return;\n        }\n        historyElement.replaceChildren(getHistoryItems(suggestions));\n    };\n}\n\nexport { SearchHistory, getRenderToHistory };\n","import { getHide, getShow, getSelectChildrenSequentially, escape } from '../../common/utils';\n\nfunction cerateSuggestionsOptions({ id, link, suggestion }, query, visited = false) {\n    const regex = new RegExp(`(${escape(query)})`, 'i');\n    const suggestionOption = document.createElement('li');\n    suggestionOption.id = id;\n    suggestionOption.dataset.suggestion = suggestion;\n    suggestionOption.dataset.link = link;\n    suggestionOption.classList.add('search-box__suggestions-item');\n    suggestionOption.innerHTML = suggestion.replace(regex, '<span class=\"bold\">$1</span>');\n\n    if (visited) {\n        suggestionOption.classList.add('search-box__suggestions-item_visited');\n    }\n\n    return suggestionOption;\n}\n\nfunction getSuggestionsOptions(previousSuggestions, currentSuggestions, query) {\n    const fragment = document.createDocumentFragment();\n\n    if (previousSuggestions != null) {\n        const visitedSuggestionsOptions = previousSuggestions.map((item) =>\n            cerateSuggestionsOptions(item, query, true)\n        );\n        fragment.append(...visitedSuggestionsOptions);\n    }\n\n    if (currentSuggestions != null) {\n        const newSuggestionsOptions = currentSuggestions.map((item) => cerateSuggestionsOptions(item, query));\n        fragment.append(...newSuggestionsOptions);\n    }\n\n    return fragment;\n}\n\nfunction getRenderToSuggestions(suggestionsElement) {\n    const hide = getHide(suggestionsElement);\n    const show = getShow(suggestionsElement);\n\n    return function (previousSuggestions, currentSuggestions, query) {\n        if ((previousSuggestions == null && currentSuggestions == null) || !query) {\n            suggestionsElement.replaceChildren('');\n            hide();\n            return;\n        }\n        suggestionsElement.replaceChildren(getSuggestionsOptions(previousSuggestions, currentSuggestions, query));\n        show();\n    };\n}\n\nfunction getSelectSuggestion(suggestions) {\n    return getSelectChildrenSequentially(suggestions, 'search-box__suggestions-item_selected');\n}\n\nexport { getRenderToSuggestions, getSelectSuggestion };\n","function createScoresCategory({ name, score_out_of_10 }) {\n    const scoreCategory = document.createElement('li');\n    const categoryLabel = document.createElement('label');\n    const categoryMeter = document.createElement('meter');\n    const categoryScore = document.createElement('span');\n\n    scoreCategory.classList.add('scores__category');\n    categoryLabel.classList.add('scores__label');\n    categoryMeter.classList.add('scores__meter');\n    categoryScore.classList.add('scores__score');\n\n    categoryLabel.textContent = `${name}:`;\n    categoryLabel.setAttribute('for', name);\n\n    categoryScore.textContent = score_out_of_10.toFixed(1);\n\n    categoryMeter.id = name;\n    categoryMeter.setAttribute('max', 10);\n    categoryMeter.setAttribute('low', 3);\n    categoryMeter.setAttribute('high', 5);\n    categoryMeter.setAttribute('optimum', 8);\n    categoryMeter.setAttribute('value', score_out_of_10);\n\n    scoreCategory.append(categoryLabel, categoryMeter, categoryScore);\n\n    return scoreCategory;\n}\nfunction getScoresCategories(categories) {\n    const fragment = document.createDocumentFragment();\n    fragment.append(...categories.map(createScoresCategory));\n    return fragment;\n}\nfunction getScoresMarkup({ name, categories, totalScore }) {\n    const scores = document.createElement('div');\n    const cityName = document.createElement('h2');\n    const categoriesScoreList = document.createElement('ul');\n    const totalScoreValue = document.createElement('p');\n\n    scores.classList.add('scores');\n    cityName.classList.add('h2');\n    categoriesScoreList.classList.add('scores__list');\n    totalScoreValue.classList.add('scores__total-score');\n\n    cityName.textContent = name;\n    categoriesScoreList.append(getScoresCategories(categories));\n    totalScoreValue.textContent = `Total score: ${totalScore.toFixed(1)}`;\n\n    scores.append(cityName, categoriesScoreList, totalScoreValue);\n\n    return scores;\n}\n\nexport { createScoresCategory, getScoresCategories, getScoresMarkup };\n","import { debounce } from './common/debounce';\nimport { onlyLast } from './common/only-last';\nimport { searchCity, getScores } from './api/api-provider';\nimport { SearchHistory, getRenderToHistory } from './components/search-history';\nimport { getRenderToSuggestions, getSelectSuggestion } from './components/suggestions';\nimport { getScoresMarkup } from './components/scores';\nimport { BaseError, ERROR_CODE } from './common/errors';\n\n// объект для работы с localStorage\nconst history = new SearchHistory(100);\n\nconst searchBoxElement = document.querySelector('.search-box');\nconst fieldElement = searchBoxElement.querySelector('.search-box__field');\nconst suggestionsElement = searchBoxElement.querySelector('.search-box__suggestions-list');\nconst historyElement = document.querySelector('.history');\nconst outputElement = document.querySelector('.output');\n\nconst renderSuggestions = getRenderToSuggestions(suggestionsElement);\nconst renderHistory = getRenderToHistory(historyElement);\nconst selectSuggestion = getSelectSuggestion(suggestionsElement);\nconst onlyLastSearchCity = onlyLast(searchCity);\nconst onlyLastGetScores = onlyLast(getScores);\nconst debouncedInputHandler = debounce(inputQueryHandler, 200);\nconst debounceShowScoresHandler = debounce(showScoresHandler, 200);\n\nsearchBoxElement.addEventListener('keydown', suggestionSelectionHandler, true);\nsearchBoxElement.addEventListener('submit', submitQueryHandler, true);\nfieldElement.addEventListener('input', debouncedInputHandler, true);\nsuggestionsElement.addEventListener('click', suggestionClickHandler);\nhistoryElement.addEventListener('click', historyClickHandler);\ndocument.addEventListener('showScore', debounceShowScoresHandler, true);\nwindow.addEventListener('storage', historyChangeHandler, true);\nwindow.onload = init;\n\nfunction init() {\n    fieldElement.value = '';\n    renderHistory(history.getRecentSearchQueries(3));\n}\n\n// для обработки ввода с клавиатуры поискового запроса\nasync function inputQueryHandler(event) {\n    // флаг для предотвращения отрисовки предложений после события 'submit'\n    sessionStorage.setItem('isSubmit', false);\n    const query = event.target.value;\n\n    if (!query) {\n        // если null, undefined, ''\n        renderSuggestions(); // очистить детей внутри блока с предложениями\n        return;\n    }\n\n    // найти 5 недавних запросов\n    const [recentSuggestionsId, recentSuggestions] = history.findRecentSearchQueries(query, 5);\n\n    if (recentSuggestions != null) {\n        renderSuggestions(recentSuggestions, null, query); // отрисовать\n        selectSuggestion('update'); // обновить замыкание хранящее первое, последнее и выбранное предложение\n    }\n\n    const [newSuggestions, error] = await onlyLastSearchCity(query);\n\n    // если за время ожидания промиса пользователь отправил форму прекратить выполнение функции\n    if (JSON.parse(sessionStorage.getItem('isSubmit'))) {\n        return;\n    }\n    if (error) {\n        // отфильтровать ошибку возникающую при отмене fetch\n        if (!(error instanceof DOMException)) {\n            console.error(error);\n        }\n        return;\n    }\n\n    let currentSuggestions;\n\n    if (newSuggestions != null && recentSuggestions != null) {\n        const maxSuggestionsCount = 10;\n        const maxNewSuggestionsCount = maxSuggestionsCount - recentSuggestions.length;\n\n        // отфильтровать из нового поиска выбранные предыдущие варианты\n        currentSuggestions = newSuggestions\n            .filter((suggestion) => !recentSuggestionsId.includes(suggestion.id))\n            .slice(0, maxNewSuggestionsCount);\n    } else if (newSuggestions != null) {\n        currentSuggestions = newSuggestions;\n    }\n\n    renderSuggestions(recentSuggestions, currentSuggestions, query);\n    selectSuggestion('update'); // обновить замыкание хранящее первое, последнее и выбранное предложение\n}\nasync function showScoresHandler(event) {\n    outputElement.replaceChildren('Loading...');\n\n    const [scores, error] = await onlyLastGetScores(event.detail);\n\n    if (error instanceof BaseError && error.status === ERROR_CODE.NotFound) {\n        outputElement.replaceChildren(error.message);\n        return;\n    }\n\n    if (error) {\n        if (!(error instanceof DOMException)) {\n            console.error(error);\n        }\n        return;\n    }\n    outputElement.replaceChildren(getScoresMarkup(scores));\n}\n\n// для возможность выбора предложения стрелками на клавиатуре\nfunction suggestionSelectionHandler(event) {\n    if (event.code === 'ArrowDown') {\n        const current = selectSuggestion('next'); // выбрать следующее предложение\n\n        if (current != null) {\n            fieldElement.value = current.dataset.suggestion;\n        }\n    }\n    if (event.code === 'ArrowUp') {\n        event.preventDefault();\n        const current = selectSuggestion('previous'); // выбрать предыдущее предложение\n\n        if (current != null) {\n            fieldElement.value = current.dataset.suggestion;\n        }\n    }\n}\n\n// для обработки отправки формы\nfunction submitQueryHandler(event) {\n    event.preventDefault();\n    sessionStorage.setItem('isSubmit', true);\n    let currentSuggestions = selectSuggestion(); // получить текущий пункт\n    if (currentSuggestions == null) {\n        // если null попробовать получить первый пункт\n        currentSuggestions = selectSuggestion('first');\n        if (currentSuggestions == null) {\n            // если null очистить строку ввода\n            fieldElement.value = '';\n            return;\n        }\n    }\n    const suggestion = {\n        id: currentSuggestions.id,\n        link: currentSuggestions.dataset.link,\n        suggestion: currentSuggestions.dataset.suggestion,\n    };\n    document.dispatchEvent(new CustomEvent('showScore', { detail: suggestion.link }));\n    history.add(suggestion); // добавляем запрос в localStorage\n    fieldElement.value = '';\n    renderSuggestions(); // удалить дочерние элементы\n    selectSuggestion('update'); // // обновить замыкание хранящее первое, последнее и выбранное предложение\n    renderHistory(history.getRecentSearchQueries(3));\n}\nfunction suggestionClickHandler(event) {\n    const element = event.target;\n    if (element instanceof HTMLLIElement) {\n        sessionStorage.setItem('isSubmit', true);\n        const suggestion = {\n            id: element.id,\n            link: element.dataset.link,\n            suggestion: element.dataset.suggestion,\n        };\n        document.dispatchEvent(new CustomEvent('showScore', { detail: suggestion.link }));\n        history.add(suggestion);\n        fieldElement.value = '';\n        renderSuggestions();\n        selectSuggestion('update');\n        renderHistory(history.getRecentSearchQueries(3));\n    }\n}\n\n// для обновления истории поиска на другой вкладке\nfunction historyChangeHandler(event) {\n    if ((event.key = 'searchHistory')) {\n        renderHistory(history.getRecentSearchQueries(3));\n    }\n}\n\nfunction historyClickHandler(event) {\n    const element = event.target;\n\n    if (element instanceof HTMLLIElement) {\n        document.dispatchEvent(new CustomEvent('showScore', { detail: event.target.dataset.link }));\n    }\n}\n"],"names":["$c1453b17ebecffdc$export$61fc7d43ac8f84b0","callee","timeoutMs","timer","args","clearTimeout","setTimeout","$d78c590fa65a0b22$export$63376f9fddf38a9c","controller","AbortController","isOverPreviousCall","async","abort","response","signal","error","$746ca1504eb3edcd$export$a490eb03cb7a0a5e","Error","constructor","status","message","super","this","$746ca1504eb3edcd$export$fe20a4d016ee5cf3","BadRequest","NotFound","InvalidResponse","NetworkError","TypeError","UnexpectedError","$5cc7fe0b6857ac45$export$7a171f172be0782e","url","fetch","method","headers","redirect","DOMException","ok","json","$026eb888a577f4df$var$SEARCH_PARAMS","URLSearchParams","$026eb888a577f4df$var$isObject","value","$026eb888a577f4df$var$hasEmbedded","$026eb888a577f4df$var$isLinks","href","$026eb888a577f4df$var$isLink","$026eb888a577f4df$var$isSearchItem","matching_full_name","_links","$026eb888a577f4df$var$isSearchResult","Array","isArray","every","$026eb888a577f4df$var$isSearchItemsArray","$026eb888a577f4df$var$isCategory","color","name","score_out_of_10","$026eb888a577f4df$var$isUaScores","teleport_city_score","$026eb888a577f4df$var$isArrayCategories","categories","$026eb888a577f4df$var$isValidGetScoresResult","_embedded","full_name","$026eb888a577f4df$var$isCityUrbanArea","$20a3098796b1c6da$export$4e7f196112fea3c5","string","replace","$20a3098796b1c6da$export$3cb5cd7f7776c81","element","classList","remove","$4512829ee5380d39$var$createHistoryItem","suggestion","link","historyItem","document","createElement","add","dataset","textContent","$9d7b14b1b697ac09$var$cerateSuggestionsOptions","id","query","visited","regex","RegExp","suggestionOption","innerHTML","$70795673f1f6acbc$export$e3e8f361ba102a01","scoreCategory","categoryLabel","categoryMeter","categoryScore","setAttribute","toFixed","append","$70795673f1f6acbc$export$cf6ebc8494d6c656","totalScore","scores","cityName","categoriesScoreList","totalScoreValue","fragment","createDocumentFragment","map","$70795673f1f6acbc$export$3a268411de804dca","$cba3eb2abed8e80a$var$history","maxLength","get","localStorage","setItem","JSON","stringify","parse","getItem","history","index","findIndex","item","splice","length","pop","getRecentSearchQueries","count","slice","findRecentSearchQueries","regexp","itemsId","items","search","push","$cba3eb2abed8e80a$var$searchBoxElement","querySelector","$cba3eb2abed8e80a$var$fieldElement","$cba3eb2abed8e80a$var$suggestionsElement","$cba3eb2abed8e80a$var$historyElement","$cba3eb2abed8e80a$var$outputElement","$cba3eb2abed8e80a$var$renderSuggestions","suggestionsElement","hide","show","previousSuggestions","currentSuggestions","replaceChildren","visitedSuggestionsOptions","newSuggestionsOptions","$9d7b14b1b697ac09$var$getSuggestionsOptions","$cba3eb2abed8e80a$var$renderHistory","historyElement","suggestions","$4512829ee5380d39$var$getHistoryItems","$cba3eb2abed8e80a$var$selectSuggestion","addedClassName","currentChild","action","firstChild","firstElementChild","lastChild","lastElementChild","nextChild","nextElementSibling","selectNext","previousChild","previousElementSibling","selectPrevious","$cba3eb2abed8e80a$var$onlyLastSearchCity","URL","set","toString","data","reduce","acc","match","$cba3eb2abed8e80a$var$onlyLastGetScores","urlString","$cba3eb2abed8e80a$var$debouncedInputHandler","event","sessionStorage","target","recentSuggestionsId","recentSuggestions","newSuggestions","console","maxNewSuggestionsCount","filter","includes","$cba3eb2abed8e80a$var$debounceShowScoresHandler","detail","addEventListener","code","current","preventDefault","current1","dispatchEvent","CustomEvent","HTMLLIElement","window","key","onload"],"version":3,"file":"index.035df07c.js.map"}